var M=Object.defineProperty,_=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var x=(p,n,g)=>n in p?M(p,n,{enumerable:!0,configurable:!0,writable:!0,value:g}):p[n]=g,y=(p,n)=>{for(var g in n||(n={}))U.call(n,g)&&x(p,g,n[g]);if(O)for(var g of O(n))$.call(n,g)&&x(p,g,n[g]);return p},S=(p,n)=>_(p,F(n));var o=(p,n,g)=>(x(p,typeof n!="symbol"?n+"":n,g),g);(function(p,n){typeof exports=="object"&&typeof module!="undefined"?module.exports=n():typeof define=="function"&&define.amd?define(n):(p=typeof globalThis!="undefined"?globalThis:p||self,p.cropper=n())})(this,function(){"use strict";function p(r){return new Promise((t,e)=>{if(URL){let a=document.createElement("img");a.src=window.URL.createObjectURL(r),a.onload=function(){window.URL.revokeObjectURL(a.src),t(a)},a.onerror=function(i){e(i)}}else if(FileReader){const a=new FileReader;a.onload=function(){let i=document.createElement("img");i.src=a.result,t(i)},a.onerror=function(i){e(i)},a.readAsDataURL(r)}})}function n(r){return new Promise((t,e)=>{let a=new XMLHttpRequest;a.open("GET",r,!0),a.responseType="blob",a.onload=()=>{t(a.response)},a.onerror=i=>{e(i)},a.send()})}function g(r,t){return Math.hypot(t.x-r.x,t.y-r.y)}var B='<div class="cropper-container" touch-action="none"><div class="cropper-box"></div></div>',D={setImageDataTypeOne:function(){const{naturalWidth:r,naturalHeight:t,naturalRatio:e}=this.initialImageData,{width:a,height:i,ratio:s}=this.containerData;let d=1;(r>a||t>i)&&(e>=s?d=a/r:d=i/t);const m=r*d,h=t*d;this.imageData={rotate:0,scale:d,width:m,height:h,left:(a-m)/2,top:(i-h)/2}},setCropBoxDataTypeOne:function(){const{width:r,height:t}=this.imageData,e=r/t,{width:a,height:i}=this.containerData,{aspect:s=1}=this.options,d=r,m=t;let h=0,l=0;s>=e?(h=d,l=d/s):(l=m,h=m*s),this.cropBoxData={width:h,height:l,ratio:h/l,left:(a-h)/2,top:(i-l)/2}},setImageDataTypeTwo:function(){const{naturalWidth:r,naturalHeight:t,naturalRatio:e}=this.initialImageData,{width:a,height:i,ratio:s}=this.cropBoxData,{width:d,height:m}=this.containerData;let h=1,l=0,c=0;e>s?h=a/r:h=i/t,l=r*h,c=t*h,this.imageData={rotate:0,width:l,height:c,scale:h,left:(d-l)/2,top:(m-c)/2}},setImageDataTypeThree:function(){const{naturalWidth:r,naturalHeight:t}=this.initialImageData,{width:e,height:a}=this.containerData;this.imageData={rotate:0,width:r,height:t,scale:1,left:(e-r)/2,top:(a-t)/2}}},N="";const w=typeof window!="undefined"&&typeof window.document!="undefined"&&document.documentElement?"ontouchstart"in document.documentElement:!1,T="cropper",C="move",I=w?"touchstart":"mousedown",b=w?"touchmove":"mousemove",X=w?"touchend":"mouseup",Y="wheel",H=200,R=100,W={aspect:1,containerWidth:600,containerHeight:300,wheelZoomRatio:.1};class L{constructor(t,e,a){o(this,"element");o(this,"options");o(this,"image");o(this,"initialImageData");o(this,"ready");o(this,"container");o(this,"cropper");o(this,"cropBox");o(this,"viewBox");o(this,"face");o(this,"containerData");o(this,"imageData");o(this,"onCropStart");o(this,"pointers");o(this,"startMoving",!1);o(this,"onCropMove");o(this,"onCropUp");o(this,"cropBoxData");o(this,"setImageDataTypeOne");o(this,"setImageDataTypeTwo");o(this,"setCropBoxDataTypeOne");o(this,"setImageDataTypeThree");o(this,"wheeling");o(this,"onWheel");o(this,"action");if(!t)throw new Error("\u7B2C\u4E00\u4E2A\u53C2\u6570\u5FC5\u987B\u662F\u56FE\u7247File\u6216\u8005url");if(!e)throw new Error("\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5FC5\u987B\u662F\u5BB9\u5668");this.element=t,this.container=e,this.ready=!1,this.wheeling=!1,this.pointers={startX1:0,startY1:0,pageX1:0,pageY1:0,originScale:1},this.action="",this.options=y(y({},W),a);const{containerWidth:i=600,containerHeight:s=300}=this.options;this.options.aspect||(this.options.aspect=i/s),this.setCropBoxDataTypeOne=D.setCropBoxDataTypeOne.bind(this),this.setImageDataTypeOne=D.setImageDataTypeOne.bind(this),this.setImageDataTypeTwo=D.setImageDataTypeTwo.bind(this),this.setImageDataTypeThree=D.setImageDataTypeThree.bind(this),this.init()}init(){const t=a=>{this.image=a,this.start()};if(this.element instanceof File){var e=this.element;if(!/^image\//.test(e.type))return;p(e).then(a=>t(a))}else n(this.element).then(a=>{p(a).then(i=>t(i))})}start(){if(!this.image)return;const{options:t}=this,{naturalWidth:e,naturalHeight:a}=this.image;this.initialImageData={naturalWidth:e,naturalHeight:a,naturalRatio:e/a};const i=t.containerWidth||H,s=t.containerHeight||R;this.containerData={width:i,height:s,ratio:i/s},this.setImageDataTypeOne(),this.setCropBoxDataTypeOne(),this.build(),this.bind(),this.ready=!0,this.triggerOptionsFn("ready")}setType(t){switch(t){case 1:this.setImageDataTypeOne(),this.setStyle();break;case 2:this.setImageDataTypeTwo(),this.setStyle();break;case 3:this.setImageDataTypeThree(),this.setStyle();break}}build(){const{image:t,container:e,containerData:a}=this;e.innerHTML=B;const i=e.querySelector(`.${T}-container`),s=i==null?void 0:i.querySelector(`.${T}-box`);this.container=e,this.cropper=i,this.cropBox=s,t.classList.add(`${T}-img`),i==null||i.appendChild(t),this.cropper.style.width=`${a.width}px`,this.cropper.style.height=`${a.height}px`,this.setStyle()}setStyle(){const{image:t,imageData:e}=this;t.style.transformOrigin="left top",t.style.transform=`translate(${e.left}px, ${e.top}px) rotate(${e.rotate}deg) scale(${e.scale})`,this.cropBox.style.width=`${this.cropBoxData.width}px`,this.cropBox.style.height=`${this.cropBoxData.height}px`,this.cropBox.style.left=`${this.cropBoxData.left}px`,this.cropBox.style.top=`${this.cropBoxData.top}px`,this.triggerOptionsFn("change")}cropStart(t){if(this.action=C,t.type==="mousedown"){const e=t;this.pointers={startX1:e.pageX,startY1:e.pageY,pageX1:e.pageX,pageY1:e.pageY,originScale:this.imageData.scale}}else{const e=t;this.pointers={startX1:e.touches[0].pageX,startY1:e.touches[0].pageY,pageX1:e.touches[0].pageX,pageY1:e.touches[0].pageY,originScale:this.imageData.scale},e.touches[1]&&(this.action=C,this.pointers.pageX2=e.touches[1].pageX,this.pointers.pageY2=e.touches[1].pageY)}this.triggerOptionsFn("cropStart")}cropMove(t){if(!this.action)return;t.preventDefault();let e={pageX:0,pageY:0};if(t.type==="mousemove"){const c=t;e={pageX:c.pageX,pageY:c.pageY}}else{const c=t,f=c.touches[0],u=c.touches[1];if(u){this.pointers.pageX2||(this.pointers.pageX2=u.pageX),this.pointers.pageY2||(this.pointers.pageY2=u.pageY);var a=g({x:f.pageX,y:f.pageY},{x:u.pageX,y:u.pageY})/g({x:this.pointers.startX1,y:this.pointers.startY1},{x:this.pointers.pageX2,y:this.pointers.pageY2});this.zoomTo(a*this.pointers.originScale),this.triggerOptionsFn("change cropMove");return}e={pageX:f.pageX,pageY:f.pageY}}const i=this.pointers;let s=e.pageX-(i.pageX1||0),d=e.pageY-(i.pageY1||0);const{left:m,top:h,scale:l}=this.imageData;this.imageData=S(y({},this.imageData),{left:m+s,top:h+d}),i.pageX1=e.pageX,i.pageY1=e.pageY,this.image.style.transform=`translate(${this.imageData.left}px, ${this.imageData.top}px) rotate(${this.imageData.rotate}deg) scale(${l})`,this.triggerOptionsFn("change cropMove")}cropUp(){this.pointers={startX1:0,startY1:0,pageX1:0,pageY1:0,originScale:1},!!this.action&&(this.action="",this.triggerOptionsFn("cropEnd"))}wheel(t){const e=Number(this.options.wheelZoomRatio)||.1;if(!this.ready||(t.preventDefault(),this.wheeling))return;this.wheeling=!0,setTimeout(()=>{this.wheeling=!1},50);const a=t.deltaY>0?1:-1;let i=Number(-a*e);i<0?i=1/(1-i):i=1+i;const{scale:s}=this.imageData;this.zoomTo(i*s)}zoomTo(t){const{naturalHeight:e,naturalRatio:a}=this.initialImageData,i=e*t,s=e*t*a;this.imageData={rotate:this.imageData.rotate,width:s,height:i,scale:t,left:this.imageData.left-(s-this.imageData.width)/2,top:this.imageData.top-(i-this.imageData.height)/2},this.setStyle()}rotateTo(t){t=t%360,this.imageData.rotate=t,this.setStyle()}getCroppedCanvas(){const{width:t,height:e,left:a,top:i}=this.cropBoxData,{left:s,top:d,rotate:m,scale:h}=this.imageData,l=document.createElement("canvas"),c=l.getContext("2d"),f=t/h,u=e/h;l.width=f,l.height=u,c.fillStyle="transparent",c.fillRect(0,0,f,u),c.save();let E=(a-s)/h,v=(i-d)/h;return c.translate(-E,-v),c.rotate(m*Math.PI/180),c.drawImage(this.image,0,0,(f+Math.abs(E))*2,(u+Math.abs(v))*2,0,0,(f+Math.abs(E))*2,(u+Math.abs(v))*2),c.restore(),l}getPreviewCanvas(){const{width:t,height:e}=this.cropBoxData,a=this.getCroppedCanvas(),i=document.createElement("canvas"),s=i.getContext("2d");return i.width=t,i.height=e,s.fillStyle="transparent",s.fillRect(0,0,t,e),s.save(),s.drawImage(a,0,0,t,e),i}bind(){this.onWheel=this.wheel.bind(this),this.onCropStart=this.cropStart.bind(this),this.onCropMove=this.cropMove.bind(this),this.onCropUp=this.cropUp.bind(this),this.cropper.addEventListener(Y,this.onWheel,{passive:!1,capture:!0}),this.cropper.addEventListener(I,this.onCropStart,!1),document.addEventListener(b,this.onCropMove,{passive:!1}),document.addEventListener(X,this.onCropUp)}unbind(){this.cropper.removeEventListener(Y,this.onWheel),this.cropper.removeEventListener(I,this.onCropStart),document.removeEventListener(b,this.onCropMove),document.removeEventListener(X,this.onCropUp)}getImageData(){return this.imageData}unbuild(){var t,e;!this.ready||(this.ready=!1,(e=(t=this.cropper)==null?void 0:t.parentNode)==null||e.removeChild(this.cropper))}clear(){this.unbuild(),this.unbind()}replace(t){this.clear(),this.element=t,this.init()}triggerOptionsFn(t){t.split(" ").forEach(a=>{const i=this.options[a];i&&typeof i=="function"&&i()})}}return L});
