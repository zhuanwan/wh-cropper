var M=Object.defineProperty,U=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var x=(c,n,d)=>n in c?M(c,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[n]=d,w=(c,n)=>{for(var d in n||(n={}))$.call(n,d)&&x(c,d,n[d]);if(O)for(var d of O(n))F.call(n,d)&&x(c,d,n[d]);return c},H=(c,n)=>U(c,_(n));var o=(c,n,d)=>(x(c,typeof n!="symbol"?n+"":n,d),d);(function(c,n){typeof exports=="object"&&typeof module!="undefined"?module.exports=n():typeof define=="function"&&define.amd?define(n):(c=typeof globalThis!="undefined"?globalThis:c||self,c.cropper=n())})(this,function(){"use strict";function c(p){return new Promise((t,e)=>{if(URL){let i=document.createElement("img");i.src=window.URL.createObjectURL(p),i.onload=function(){window.URL.revokeObjectURL(i.src),t(i)},i.onerror=function(a){e(a)}}else if(FileReader){const i=new FileReader;i.onload=function(){let a=document.createElement("img");a.src=i.result,t(a)},i.onerror=function(a){e(a)},i.readAsDataURL(p)}})}function n(p){return new Promise((t,e)=>{let i=new XMLHttpRequest;i.open("GET",p,!0),i.responseType="blob",i.onload=()=>{t(i.response)},i.onerror=a=>{e(a)},i.send()})}var d='<div class="cropper-container" touch-action="none"><div class="cropper-box"></div></div>',m={setImageDataTypeOne:function(){const{naturalWidth:p,naturalHeight:t,naturalRatio:e}=this.initialImageData,{width:i,height:a,ratio:s}=this.containerData;let l=1;(p>i||t>a)&&(e>=s?l=i/p:l=a/t);const g=p*l,r=t*l;this.imageData={rotate:0,scale:l,width:g,height:r,left:(i-g)/2,top:(a-r)/2}},setCropBoxDataTypeOne:function(){const{width:p,height:t}=this.imageData,e=p/t,{width:i,height:a}=this.containerData,{aspect:s=1}=this.options,l=p,g=t;let r=0,h=0;s>=e?(r=l,h=l/s):(h=g,r=g*s),this.cropBoxData={width:r,height:h,ratio:r/h,left:(i-r)/2,top:(a-h)/2}},setImageDataTypeTwo:function(){const{naturalWidth:p,naturalHeight:t,naturalRatio:e}=this.initialImageData,{width:i,height:a,ratio:s}=this.cropBoxData,{width:l,height:g}=this.containerData;let r=1,h=0,u=0;e>s?r=i/p:r=a/t,h=p*r,u=t*r,this.imageData={rotate:0,width:h,height:u,scale:r,left:(l-h)/2,top:(g-u)/2}},setImageDataTypeThree:function(){const{naturalWidth:p,naturalHeight:t}=this.initialImageData,{width:e,height:i}=this.containerData;this.imageData={rotate:0,width:p,height:t,scale:1,left:(e-p)/2,top:(i-t)/2}}},X="";const y=typeof window!="undefined"&&typeof window.document!="undefined"&&document.documentElement?"ontouchstart"in document.documentElement:!1,T="cropper",C=y?"touchstart":"mousedown",I=y?"touchmove":"mousemove",b=y?"touchend touchcancel":"mouseup",B="wheel",R=200,S=100,W={aspect:1,containerWidth:600,containerHeight:300,wheelZoomRatio:.1};class L{constructor(t,e,i){o(this,"element");o(this,"options");o(this,"image");o(this,"initialImageData");o(this,"ready");o(this,"container");o(this,"cropper");o(this,"cropBox");o(this,"viewBox");o(this,"face");o(this,"containerData");o(this,"imageData");o(this,"onCropStart");o(this,"pointer");o(this,"startMoving",!1);o(this,"onCropMove");o(this,"onCropUp");o(this,"cropBoxData");o(this,"setImageDataTypeOne");o(this,"setImageDataTypeTwo");o(this,"setCropBoxDataTypeOne");o(this,"setImageDataTypeThree");o(this,"wheeling");o(this,"onWheel");if(!t)throw new Error("\u7B2C\u4E00\u4E2A\u53C2\u6570\u5FC5\u987B\u662F\u56FE\u7247File\u6216\u8005url");if(!e)throw new Error("\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5FC5\u987B\u662F\u5BB9\u5668");this.element=t,this.container=e,this.ready=!1,this.wheeling=!1,this.pointer={startX:0,startY:0,distanchX:0,distanchY:0},this.options=w(w({},W),i);const{containerWidth:a=600,containerHeight:s=300}=this.options;this.options.aspect||(this.options.aspect=a/s),this.setCropBoxDataTypeOne=m.setCropBoxDataTypeOne.bind(this),this.setImageDataTypeOne=m.setImageDataTypeOne.bind(this),this.setImageDataTypeTwo=m.setImageDataTypeTwo.bind(this),this.setImageDataTypeThree=m.setImageDataTypeThree.bind(this),this.init()}init(){const t=i=>{this.image=i,this.start()};if(this.element instanceof File){var e=this.element;if(!/^image\//.test(e.type))return;c(e).then(i=>t(i))}else n(this.element).then(i=>{c(i).then(a=>t(a))})}start(){if(!this.image)return;const{options:t}=this,{naturalWidth:e,naturalHeight:i}=this.image;this.initialImageData={naturalWidth:e,naturalHeight:i,naturalRatio:e/i};const a=t.containerWidth||R,s=t.containerHeight||S;this.containerData={width:a,height:s,ratio:a/s},this.setImageDataTypeOne(),this.setCropBoxDataTypeOne(),this.build(),this.bind(),this.ready=!0,this.triggerOptionsFn("ready")}setType(t){switch(t){case 1:this.setImageDataTypeOne(),this.setStyle();break;case 2:this.setImageDataTypeTwo(),this.setStyle();break;case 3:this.setImageDataTypeThree(),this.setStyle();break}}build(){const{image:t,container:e,containerData:i}=this;e.innerHTML=d;const a=e.querySelector(`.${T}-container`),s=a==null?void 0:a.querySelector(`.${T}-box`);this.container=e,this.cropper=a,this.cropBox=s,t.classList.add(`${T}-img`),a==null||a.appendChild(t),this.cropper.style.width=`${i.width}px`,this.cropper.style.height=`${i.height}px`,this.setStyle()}setStyle(){const{image:t,imageData:e}=this;t.style.transformOrigin="left top",t.style.transform=`translate(${e.left}px, ${e.top}px) rotate(${e.rotate}deg) scale(${e.scale})`,this.cropBox.style.width=`${this.cropBoxData.width}px`,this.cropBox.style.height=`${this.cropBoxData.height}px`,this.cropBox.style.left=`${this.cropBoxData.left}px`,this.cropBox.style.top=`${this.cropBoxData.top}px`,this.triggerOptionsFn("change")}cropStart(t){if(this.startMoving=!0,t.type==="mousedown"){const e=t;this.pointer={startX:e.clientX,startY:e.clientY,distanchX:0,distanchY:0}}else{const e=t;this.pointer={startX:e.touches[0].clientX,startY:e.touches[0].clientY,distanchX:0,distanchY:0}}this.triggerOptionsFn("cropStart")}cropMove(t){if(t.preventDefault(),!this.startMoving)return;let e,i;if(t.type==="mousemove"){const h=t;e=h.clientX,i=h.clientY}else{const h=t;e=h.touches[0].clientX,i=h.touches[0].clientY}let a=e-this.pointer.startX,s=i-this.pointer.startY;const{left:l,top:g,scale:r}=this.imageData;this.imageData=H(w({},this.imageData),{left:l+a,top:g+s}),this.pointer.startX=e,this.pointer.startY=i,this.image.style.transform=`translate(${this.imageData.left}px, ${this.imageData.top}px) rotate(${this.imageData.rotate}deg) scale(${r})`,this.triggerOptionsFn("change cropMove")}cropUp(){!this.startMoving||(this.startMoving=!1,this.triggerOptionsFn("cropEnd"))}wheel(t){const e=Number(this.options.wheelZoomRatio)||.1;if(!this.ready||(t.preventDefault(),this.wheeling))return;this.wheeling=!0,setTimeout(()=>{this.wheeling=!1},50);const i=t.deltaY>0?1:-1;let a=Number(-i*e);a<0?a=1/(1-a):a=1+a;const{scale:s}=this.imageData;this.zoomTo(a*s)}zoomTo(t){const{naturalHeight:e,naturalRatio:i}=this.initialImageData,{width:a,height:s}=this.containerData,l=e*t,g=e*t*i;this.imageData={rotate:this.imageData.rotate,width:g,height:l,scale:t,left:(a-g)/2,top:(s-l)/2},this.setStyle()}rotateTo(t){t=t%360,this.imageData.rotate=t,this.setStyle()}getCroppedCanvas(){const{width:t,height:e,left:i,top:a}=this.cropBoxData,{left:s,top:l,rotate:g,scale:r}=this.imageData,h=document.createElement("canvas"),u=h.getContext("2d"),f=t/r,D=e/r;h.width=f,h.height=D,u.fillStyle="transparent",u.fillRect(0,0,f,D),u.save();let E=(i-s)/r,v=(a-l)/r;return u.translate(-E,-v),u.rotate(g*Math.PI/180),u.drawImage(this.image,0,0,(f+Math.abs(E))*2,(D+Math.abs(v))*2,0,0,(f+Math.abs(E))*2,(D+Math.abs(v))*2),u.restore(),h}getPreviewCanvas(){const{width:t,height:e}=this.cropBoxData,i=this.getCroppedCanvas(),a=document.createElement("canvas"),s=a.getContext("2d");return a.width=t,a.height=e,s.fillStyle="transparent",s.fillRect(0,0,t,e),s.save(),s.drawImage(i,0,0,t,e),a}bind(){this.onWheel=this.wheel.bind(this),this.onCropStart=this.cropStart.bind(this),this.onCropMove=this.cropMove.bind(this),this.onCropUp=this.cropUp.bind(this),this.cropper.addEventListener(B,this.onWheel,{passive:!1,capture:!0}),this.cropper.addEventListener(C,this.onCropStart,!1),document.addEventListener(I,this.onCropMove,{passive:!1}),document.addEventListener(b,this.onCropUp)}unbind(){this.cropper.removeEventListener(B,this.onWheel),this.cropper.removeEventListener(C,this.onCropStart),document.removeEventListener(I,this.onCropMove),document.removeEventListener(b,this.onCropUp)}getImageData(){return this.imageData}unbuild(){var t,e;!this.ready||(this.ready=!1,(e=(t=this.cropper)==null?void 0:t.parentNode)==null||e.removeChild(this.cropper))}clear(){this.unbuild(),this.unbind()}replace(t){this.clear(),this.element=t,this.init()}triggerOptionsFn(t){t.split(" ").forEach(i=>{const a=this.options[i];a&&typeof a=="function"&&a()})}}return L});
